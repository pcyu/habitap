extends 1layout

block content
  div.y-template
    h2 Habit History
    each habit, index in habits
      div.habitTile.cf
        h2 #{habit.question}
        div.updateForm
          form.daily(action=`/users/${username}/delete/${habit.habitId}/?_method=DELETE` method='post')
            input(type='submit',habit=`${habit.habitId}`,question=`${habit.question}`,class='delete-button',value='Delete')
        div.habitDate
          div #{habit.startDate}
          p to
          div #{habit.endDate}
          canvas(id= ("myChart-"+ index) width="400" height="400")
        h2 Previously named questions
        each item in questions
          div #{item.question}
          div #{item.revisionDate}    
  script(src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.js")
  script.
      window.onload = function() {
        var habits = !{JSON.stringify(habits)};
        habits.forEach((item, index) => {
          const yesArray = item.dailyCheck.filter(yes => yes === 1);
          const noArray = item.dailyCheck.filter(no => no === 0);
          const missArray = item.dailyCheck.filter(miss => miss === -1);
          item.data = [yesArray.length, noArray.length, missArray.length]
          var ctx = document.getElementById("myChart-"+index).getContext('2d');
          var chart = new Chart(ctx, {
            type: 'doughnut',
            data: {
              labels: ["Success", "Fail", "Missed Days"],
              datasets: [{
                label: 'Number of votes',
                data: item.data,
                backgroundColor: ["#2471A3", "#A93226", "#D3D3D3"],
                borderColor: ["#17202A"],
                borderWidth: 1
              }],
            },
            options: {
              title: { 
                display: true,
                text: "Habit Chart",
              },
              legend: {
                position: 'right'
              },
            }
          });
        })
      };